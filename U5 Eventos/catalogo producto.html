<html>
    <head>
        <title>Catálogo de productos</title>
        <style>
            body 
            {
                font-family: Arial, Helvetica, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            .controls 
            {
                margin: 20px 0;
                padding: 10px;
                background: rgb(135, 232, 223);
            }
            button 
            {
                padding: 8px 16px;
                margin: 5px;
                cursor: pointer;
            }
            .form-container 
            {
                display: none;
                border: 1px solid #db9f9f;
                padding: 20px;
                margin: 20px 0;
                background: wheat;
            }
            .form-group 
            {
                margin: 10px 0;
            }
            label 
            {
                display: block;
                margin-bottom: 5px;
            }
            input, textarea 
            {
                width: 100%;
                padding: 8px;
                margin: 5px 0;
            }
            .error 
            {
                color: red;
                font-size: 14px;
                display: none; 
            }

            .catalog {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
                margin: 20px 0;
            }
            .product-card 
            {
                border: 1px solid #b8e088;
                padding: 10px;
                text-align: center;
            }
            .product-image 
            {
                object-fit: cover;
                cursor: pointer;
            }
            .product-name 
            {
                margin: 10px 0;
                font-weight: bold;
            }
            .product-details 
            {
                display: none;
                margin-top: 10px;
                padding: 10px;
                background: #f095ee;
                text-align: left;
            }
        </style>
    </head>
    <body>
        <h1>Catálogo de productos</h1>
        <div class="controls">
            <button id="addProductBtn">Añadir Producto</button>
            <span id="productCount">Total : 0 productos</span>
            <button id="clearCatalogBtn">Limpiar Catálogo</button>
        </div>

        <div id="productForm" class="form-container">
            <h2>Nuevo productos</h2>
            <form id="productFormElement">
                <div class="form-group">
                   <label for="productId">ID del producto : </label> 
                   <input type="text" id="productId">
                   <div class="error" id="productIdError">ID obligatorio y único</div>
                </div>

                <div class="form-group">
                    <label for="productName">Nombre : </label>
                    <input type="text" id="productName">
                    <div class="error" id="productNameError">Nombre obligatorio</div>
                </div>

                <div class="form-group">
                    <label for="productDescription">Descripción : </label>
                    <textarea id="productDescription" rows="3"></textarea>
                    <div class="error" id="productDescriptionError">Descripción obligatorio</div>
                </div>

                <div class="form-group">
                    <label for="productPrice">Precio (€) : </label>
                    <input type="number" id="productPrice" min="0" step="0.01">
                    <div class="error" id="productPriceError">Precio debe ser positivo</div>
                </div>

                <div class="form-group">
                    <label for="productImage">Imagen : </label>
                    <input type="file" id="productImage" accept="image/*">
                    <div class="error" id="productImageError">Imagen obligatoria</div>
                </div>

                <button type="submit">Guardar Producto</button>
                <button type="button" id="cancelBtn">Cancelar</button>
            </form>
        </div>

        <div id="catalog" class="catalog">
            <div class="empty-catalog">
                <p>No hay productos en el catálogo</p>
            </div>
        </div>
        
        <script>
            //Array principal para guardar los datos de los productos.
            let products = [];
            
            // Contador que se actualiza al añadir o eliminar productos.
            let productCount = 0;

            //Referencias a elementos del DOM.
            const addProductBtn = document.getElementById('addProductBtn');
            const clearCatalogBtn = document.getElementById('clearCatalogBtn');
            const productForm = document.getElementById('productForm');
            const productFormElement = document.getElementById('productFormElement');
            const cancelBtn = document.getElementById('cancelBtn');
            const catalog = document.getElementById('catalog');
            const productCountElement = document.getElementById('productCount');
            const emptyCatalogMessage = document.querySelector('.empty-catalog');

            //Evento para mostrar el formulario.
            addProductBtn.addEventListener('click', showProductForm);
            
            //Evento para ocultar el formulario y resetear.
            cancelBtn.addEventListener('click', hideProductForm);

            //Evento principal: manejo del envío del formulario.
            productFormElement.addEventListener('submit', handleFormSubmit);

            //Evento para limpiar el catálogo
            clearCatalogBtn.addEventListener('click', clearCatalog);
            
            //Muestra el formulario.
            function showProductForm() 
            {
                productForm.style.display = 'block';
            }
            
            //Oculta el formulario y lo resetea.
            function hideProductForm() 
            {
                productForm.style.display = 'none';
                resetForm();
            }
            
            //Limpia campos y oculta errores.
            function resetForm() 
            {
                productFormElement.reset();
                const errorElements = document.querySelectorAll('.error');
                errorElements.forEach(error => 
                {
                    error.style.display = 'none';
                });
            }
            
            //Actualiza el contador de productos visible.
            function updateProductCount() 
            {
                productCountElement.textContent = `Total : ${productCount} productos`;
            }

            function handleFormSubmit(event) {
                //Prevenir la recarga de la página (PUNTO CRÍTICO).
                event.preventDefault();

                // Obtener los valores de los campos.
                const productId = document.getElementById('productId').value.trim();
                const productName = document.getElementById('productName').value.trim();
                const productDescription = document.getElementById('productDescription').value.trim();
                const productPrice = parseFloat(document.getElementById('productPrice').value);
                const productImage = document.getElementById('productImage').files[0];

                // Validar la entrada.
                const isValid = validateForm(productId, productName, productDescription, productPrice, productImage);

                if(isValid) 
                {
                    //Si la validación es exitosa, crear el producto.
                    createProduct(productId, productName, productDescription, productPrice, productImage);
                    
                    //Ocultar formulario después de la creación.
                    hideProductForm(); 
                }
            }

            //Valida todos los campos del formulario
            function validateForm(productId, productName, productDescription, productPrice, productImage) {
                let isValid = true;
                
                //Ocultar errores anteriores.
                const errorElements = document.querySelectorAll('.error');
                errorElements.forEach(error => { error.style.display = 'none'; });

                //Validar ID: obligatorio y único.
                if(!productId) 
                {
                    document.getElementById('productIdError').style.display = 'block';
                    isValid = false;
                }
                //Comprobar unicidad del ID usando array.some().
                else if (products.some(product => product.id === productId)) 
                {
                    document.getElementById('productIdError').textContent = 'Este ID ya existe';
                    document.getElementById('productIdError').style.display = 'block';
                    isValid = false;
                }

                //Validar Nombre.
                if(!productName) 
                {
                    document.getElementById('productNameError').style.display = 'block';
                    isValid = false;
                }
                //Validar Descripción.
                if(!productDescription) 
                {
                    document.getElementById('productDescriptionError').style.display = 'block';
                    isValid = false;
                }
                //Validar Precio (numérico y positivo).
                if(isNaN(productPrice) || productPrice <= 0) 
                {
                    document.getElementById('productPriceError').style.display = 'block';
                    isValid = false;
                }
                //Validar Imagen.
                if(!productImage) 
                {
                    document.getElementById('productImageError').style.display = 'block';
                    isValid = false;
                }
                return isValid;
            }
            function createProduct(id, name, description, price, imageFile) 
            {
                // Crear el objeto de producto.
                const product = 
                {
                    id: id,
                    name: name,
                    description: description,
                    price: price,
                    // Obtener URL para la imagen.
                    imageUrl: URL.createObjectURL(imageFile) 
                };
                
                //Añadir el producto al array.
                products.push(product);
                productCount++;

                //Actualizar el contador.
                updateProductCount();
                // Si ya hay productos, ocultar el mensaje de catálogo vacío.
                if(emptyCatalogMessage.style.display !== 'none') 
                {
                    emptyCatalogMessage.style.display='none';
                }
            }

            //Limpiar todo el catálogo
            function clearCatalog() 
            {
                if (productCount === 0) 
                {
                    alert("El catalgo ya esta vacio");
                    return;
                }

                if(confirm('¿Eliminar todos los productos?')) 
                {
                    //Vaciar el array y contador.
                    products = [];
                    productCount = 0;
                    
                    updateProductCount();
                }
            }
        </script>
    </body>
</html>